whammywibbles = [
	[
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
	]
	[
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
	]
	[
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
	]
	[
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
		1.0
	]
]

script star_power_reset 
	change structurename = <player_status> star_power_amount = 0.0
	change structurename = <player_status> star_power_sequence = 0
	change structurename = <player_status> star_power_note_count = 0
	change structurename = <player_status> star_power_used = 0
	change structurename = <player_status> current_star_array_entry = 0
endscript
star_power_ready_on_p1 = 0
star_power_ready_on_p2 = 0

script show_star_power_ready 
	if ($cheat_performancemode = 1)
		return
	endif
	if screenelementexists \{id = hud_root}
		gamemode_gettype
		if (<type> = training)
			return
		endif
		if gamemode_isbandscoring
			hud_create_message \{band
				text = qs(0x8ba36464)
				priority = 2}
		elseif (($<player_status>.star_power_used) = 0)
			if ($<player_status>.part = vocals)
				vocals_message_delayed {player = ($<player_status>.player) text = qs(0x8ba36464) rgba = [128 240 240 255]}
			else
				if (($<player_status>.hud_parent) = alias_g1)
					highway_num = 1
				elseif (($<player_status>.hud_parent) = alias_g2)
					highway_num = 2
				elseif (($<player_status>.hud_parent) = alias_g3)
					highway_num = 3
				endif
				hud_create_message {
					player = ($<player_status>.player)
					text = qs(0x8ba36464)
					style_script = hud_message_flame_style_starpower_ready
					style_script_params = {highway_num = <highway_num>}
					priority = 2
				}
			endif
		endif
		return
	endif
	if ($game_mode = p2_coop || $game_mode = p2_quickplay)
		<player_status> = player1_status
	endif
	if isps3
		if NOT ($current_song = jamsession)
			if issingleplayergame
				if NOT ($is_attract_mode = 1)
					soundevent \{event = star_power_available_gh4}
				endif
			else
				if NOT ($is_attract_mode = 1)
					spawnscriptnow star_power_ready_sfx_multiplayer params = {player = ($<player_status>.player)}
				endif
			endif
		endif
	else
		if issingleplayergame
			if NOT ($is_attract_mode = 1)
				soundevent \{event = star_power_available_gh4}
			endif
		else
			if NOT ($is_attract_mode = 1)
				spawnscriptnow star_power_ready_sfx_multiplayer params = {player = ($<player_status>.player)}
			endif
		endif
	endif
	spawnscriptnow rock_meter_star_power_on params = {player_status = <player_status>}
	formattext checksumname = player_container 'HUD_Note_Streak_Combo%d' d = ($<player_status>.player)
	begin
	if NOT screenelementexists id = <player_container>
		break
	endif
	wait \{1
		gameframe}
	repeat
	if ($<player_status>.star_power_used = 1)
		return
	endif
	if ($<player_status>.player = 1)
		if ($star_power_ready_on_p1 = 1)
			return
		else
			change \{star_power_ready_on_p1 = 1}
		endif
	else
		if ($star_power_ready_on_p2 = 1)
			return
		else
			change \{star_power_ready_on_p2 = 1}
		endif
	endif
	extendcrc star_power_ready_text ($<player_status>.text) out = id
	if (($game_mode = p2_faceoff) || ($game_mode = p2_pro_faceoff))
		if ($<player_status>.player = 1)
			original_pos = (($hud_screen_elements [0].pos) - (225.0, 50.0))
		else
			original_pos = (($hud_screen_elements [0].pos) + (225.0, -50.0))
		endif
		base_scale = 0.8
		scale_big_mult = 1.2
	else
		if ($game_mode = p2_career || $game_mode = p2_coop || $game_mode = p2_quickplay)
			original_pos = (($hud_screen_elements [0].pos) - (0.0, 60.0))
		else
			original_pos = (($hud_screen_elements [0].pos) - (0.0, 20.0))
		endif
		base_scale = 1.2
		scale_big_mult = 1.5
	endif
	if screenelementexists id = <id>
		<id> :legacydomorph pos = <original_pos> scale = 4 rgba = [190 225 255 250] alpha = 0 rot_angle = 3
	endif
	extendcrc hud_destroygroup_window ($<player_status>.text) out = hud_destroygroup
	spawnscriptnow hud_lightning_alert params = {player_status = <player_status> player = ($<player_status>.player) alert_id = <id> player_container = <hud_destroygroup>}
	if screenelementexists id = <id>
		<id> :legacydomorph pos = <original_pos> scale = <base_scale> alpha = 1 time = 0.3 rot_angle = -3 motion = ease_in
	endif
	if screenelementexists id = <id>
		<id> :legacydomorph pos = <original_pos> scale = (<base_scale> * <scale_big_mult>) time = 0.3 rot_angle = 4 motion = ease_out
	endif
	if screenelementexists id = <id>
		<id> :legacydomorph pos = <original_pos> scale = <base_scale> time = 0.3 rot_angle = -5 rgba = [145 215 235 250] motion = ease_in
	endif
	rotation = 10
	begin
	<rotation> = (<rotation> * -0.7)
	if screenelementexists id = <id>
		<id> :legacydomorph pos = <original_pos> rot_angle = <rotation> alpha = 1 time = 0.08 motion = ease_out
	endif
	repeat 12
	if screenelementexists id = <id>
		<id> :legacydomorph pos = <original_pos> rot_angle = 0 motion = ease_out
	endif
	if screenelementexists id = <id>
		<id> :legacydomorph pos = (<original_pos> - (0.0, 230.0)) scale = (<base_scale> * 0.5) alpha = 0 time = 0.3 motion = ease_in
	endif
	if ($<player_status>.player = 1)
		change \{star_power_ready_on_p1 = 0}
	else
		change \{star_power_ready_on_p2 = 0}
	endif
endscript
showing_raise_axe = 0

script show_coop_raise_axe_for_starpower 
endscript

script reset_star_array 
	get_song_struct song = <song_name>
	get_notetrack_part_text player_status = <player_status> song_name = <song_name>
	count = 0
	begin
	get_song_prefix song = <song_name>
	if (<count> = 0)
		get_difficulty_text_nl difficulty = <difficulty> no_rhythm
	else
		get_difficulty_text_nl \{difficulty = expert}
	endif
	if ($game_mode = p2_battle ||
			$boss_battle = 1)
		formattext checksumname = song '%s_%p%d_starbattlemode' s = <song_prefix> p = <part> d = <difficulty_text_nl> addtostringlookup
		change structurename = <player_status> sp_phrases_total = 0
	elseif ($game_mode = p2_faceoff)
		formattext checksumname = song '%s_%pfaceoffstar' s = <song_prefix> p = <part> addtostringlookup
	else
		formattext checksumname = song '%s_%p%d_star' s = <song_prefix> p = <part> d = <difficulty_text_nl> addtostringlookup
	endif
	formattext checksumname = drum_unmute '%s_%d_DrumUnmute' s = <song_prefix> d = <difficulty_text_nl> addtostringlookup
	formattext checksumname = drum_fill '%s_%d_DrumFill' s = <song_prefix> d = <difficulty_text_nl> addtostringlookup
	getarraysize $<song>
	if (<array_size> > 0)
		break
	endif
	count = 1
	repeat 2
	change structurename = <player_status> current_song_star_array = <song>
	change structurename = <player_status> current_star_array_entry = 0
	change structurename = <player_status> current_drum_unmute_array = <drum_unmute>
	change structurename = <player_status> current_drum_fill_array = <drum_fill>
endscript

script do_starpower_stagefx 
	spawnscriptlater do_starpower_teslafx id = <scriptid> params = {<...>}
endscript

script do_starpower_teslafx 
	obj_id = ($<player_status>.band_member)
	if NOT compositeobjectexists name = <obj_id>
		return
	endif
	if <obj_id> :ishidden
		return
	endif
	getpakmancurrent \{map = zones}
	extendcrc <pak> '_GFX_TRG_TeslaNode_' out = zoneprefix
	switch ($<player_status>.part)
		case bass
		case guitar
		bone = bone_guitar_body
		case drum
		bone = bone_ik_hand_guitar_r
		case vocals
		bone = bone_mic_microphone
	endswitch
	formattext checksumname = teslaparticlefxid '%p_StarPower_TeslaParticleFX' p = <player_text>
	createparticlesystem name = <teslaparticlefxid> objid = ($<player_status>.band_member) bone = <bone> params_script = $gp_starpower_teslalightning01
	i = 1
	begin
	switch ($<player_status>.part)
		case bass
		case guitar
		if (RandomInteger (0.0, 1.0) = 0)
			bone = bone_guitar_fret_pos
		else
			bone = bone_guitar_body
		endif
		case drum
		b = RandomInteger (0.0, 4.0)
		switch <b>
			case 0
			bone = bone_guitar_string_1
			case 1
			bone = bone_ik_hand_guitar_l
			case 2
			bone = bone_ik_hand_guitar_r
			case 3
			bone = bone_guitar_fret_pos
			case 4
			bone = bone_guitar_body
		endswitch
		case vocals
		b = RandomInteger (0.0, 2.0)
		switch <b>
			case 0
			bone = bone_mic_stand
			case 1
			bone = bone_mic_adjust_height
			case 2
			bone = bone_mic_microphone
		endswitch
	endswitch
	formattext checksumname = scriptid '%p_StarPower_TeslaFX%i' p = <player_text> i = <i>
	formattext checksumname = teslafxid '%p_StarPower_TeslaFXID%i' p = <player_text> i = <i>
	spawnscriptlater create_starpower_teslafx id = <scriptid> params = {
		<...>
		zoneprefix = <zoneprefix>
		teslafxid = <teslafxid>
		bone = <bone>
		nodenum = RandomInteger (1.0, 10.0)
	}
	i = (<i> + 1)
	repeat RandomInteger (2.0, 4.0)
	begin
	wait RandomFloat (0.1, 1.0) seconds
	i = RandomInteger (1.0, 4.0)
	formattext checksumname = scriptid '%p_StarPower_TeslaFX%i' p = <player_text> i = <i>
	formattext checksumname = teslafxid '%p_StarPower_TeslaFXID%i' p = <player_text> i = <i>
	killspawnedscript id = <scriptid>
	deleteteslaeffectobject name = <teslafxid>
	if (<i> = 1 || <i> = 2 || RandomInteger (0.0, 1.0) = 1)
		switch ($<player_status>.part)
			case bass
			case guitar
			if (RandomInteger (0.0, 1.0) = 0)
				bone = bone_guitar_fret_pos
			else
				bone = bone_guitar_body
			endif
			case drum
			b = RandomInteger (0.0, 4.0)
			switch <b>
				case 0
				bone = bone_guitar_string_1
				case 1
				bone = bone_ik_hand_guitar_l
				case 2
				bone = bone_ik_hand_guitar_r
				case 3
				bone = bone_guitar_fret_pos
				case 4
				bone = bone_guitar_body
			endswitch
			case vocals
			b = RandomInteger (0.0, 2.0)
			switch <b>
				case 0
				bone = bone_mic_stand
				case 1
				bone = bone_mic_adjust_height
				case 2
				bone = bone_mic_microphone
			endswitch
		endswitch
		spawnscriptlater create_starpower_teslafx id = <scriptid> params = {
			<...>
			zoneprefix = <zoneprefix>
			teslafxid = <teslafxid>
			bone = <bone>
			nodenum = RandomInteger (1.0, 10.0)
		}
	endif
	repeat
endscript

script create_starpower_teslafx 
	create_starpower_teslafx_cfunc_setup
	begin
	if create_starpower_teslafx_cfunc
		break
	endif
	wait \{1
		gameframe}
	repeat
	create_starpower_teslafx_cfunc_cleanup
endscript

script kill_starpower_stagefx \{ifempty = 1}
	formattext checksumname = scriptid '%p_StarPower_StageFX' p = <player_text>
	killspawnedscript id = <scriptid>
	formattext checksumname = teslaparticlefxid '%p_StarPower_TeslaParticleFX' p = <player_text>
	manglechecksums a = <teslaparticlefxid> b = ($<player_status>.band_member)
	if iscreated <mangled_id>
		<mangled_id> :emitrate rate = 0
		<mangled_id> :destroy ifempty = <ifempty>
	endif
	if (<ifempty> = 0)
		destroyparticlesbygroupid \{groupid = starpowerfx}
	endif
	i = 1
	begin
	formattext checksumname = scriptid '%p_StarPower_TeslaFX%i' p = <player_text> i = <i>
	formattext checksumname = teslafxid '%p_StarPower_TeslaFXID%i' p = <player_text> i = <i>
	killspawnedscript id = <scriptid>
	deleteteslaeffectobject name = <teslafxid>
	i = (<i> + 1)
	repeat 4
endscript
using_starpower_camera = false

script do_starpower_camera 
	return
	if ($using_starpower_camera = true || $using_walk_camera = true)
		return
	endif
	change \{using_starpower_camera = true}
	wait \{1
		gameframe}
	change \{cameracuts_allownotescripts = false}
	cameracuts_setarrayprefix \{prefix = 'cameras_starpower'
		changetime = 2500
		length = 7000}
	wait \{7
		seconds}
	cameracuts_setarrayprefix \{prefix = 'cameras'}
	change \{cameracuts_allownotescripts = true}
	change \{using_starpower_camera = false}
endscript

script kill_starpower_camera \{changecamera = 1}
	if ($using_starpower_camera = false)
		return
	endif
	killspawnedscript \{name = do_starpower_camera}
	if (<changecamera> = 1)
		cameracuts_setarrayprefix \{prefix = 'cameras'}
	endif
	change \{cameracuts_allownotescripts = true}
	change \{using_starpower_camera = false}
endscript

script set_star_request_pending 
	printf qs(0x5e79940c) d = <player>
	wait \{2.5
		seconds}
	printf qs(0xd0d1a1fe) d = <player>
endscript
