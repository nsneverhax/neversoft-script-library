ve_bink_texture_slot = 0
video_editor_bink_list = [
	none
	Filter_FILM_01
	Filter_VIDEO_01
	Filter_BurlapEdges_01
	Filter_PaperEdges_01
	Filter_SilentFilm_01
	Filter_Grunge_01
	Filter_Fence_01
	Filter_GunBarrel_01
	Filter_Heraldry_01
	Filter_Printspots_01
	Filter_CrinkledPaper_01
	Filter_sponsor_adio_32
	Filter_sponsor_almost_32
	Filter_sponsor_altamont_32
	Filter_sponsor_baker_32
	Filter_sponsor_billabong_32
	Filter_sponsor_birdhouse_32
	Filter_sponsor_dgk_32
	Filter_sponsor_dvs_32
	Filter_sponsor_electric_32
	Filter_sponsor_element_32
	Filter_sponsor_emerica_32
	Filter_sponsor_es_32
	Filter_sponsor_etnies_32
	Filter_sponsor_flip_32
	Filter_sponsor_focus_32
	Filter_sponsor_globe_32
	Filter_sponsor_habitat_32
	Filter_sponsor_hawk_clothing_32
	Filter_sponsor_hurley_32
	Filter_sponsor_independent_32
	Filter_sponsor_matix_32
	Filter_sponsor_nike_sb_32
	Filter_sponsor_nixon_32
	Filter_sponsor_oakley_32
	Filter_sponsor_ogio_32
	Filter_sponsor_pro_tec_32
	Filter_sponsor_quicksilver_32
	Filter_sponsor_rds_32
	Filter_sponsor_sessions_32
	Filter_sponsor_skull_candy_32
	Filter_sponsor_slap_32
	Filter_sponsor_split_32
	Filter_sponsor_transworld_32
	Filter_sponsor_vans_32
	Filter_sponsor_volcom_stone_32
	Filter_sponsor_von_zipper_32
	Filter_sponsor_zoo_york_32
	Filter_sponsor_zumiez_32
]
video_editor_bink_details = {
	none = {
		text = "None"
	}
	Filter_VIDEO_01 = {
		movie = 'Filter_VIDEO_01'
		text = "Video Streaks"
		loop_start = 1
		loop_end = 60
		last_frame = 61
	}
	Filter_FILM_01 = {
		movie = 'Filter_FILM_01'
		text = "Film Grain"
		loop_start = 1
		loop_end = 60
		last_frame = 61
	}
	Filter_BurlapEdges_01 = {
		movie = 'Filter_BurlapEdges_01'
		text = "Burlap Frame"
		loop_start = 1
		loop_end = 60
		last_frame = 61
		purchase_cost = 100
	}
	Filter_PaperEdges_01 = {
		movie = 'Filter_PaperEdges_01'
		text = "Paper Edges"
		loop_start = 1
		loop_end = 60
		last_frame = 61
		purchase_cost = 100
	}
	Filter_SilentFilm_01 = {
		movie = 'Filter_SilentFilm_01'
		text = "Silent Film Frame"
		loop_start = 1
		loop_end = 60
		last_frame = 61
		purchase_cost = 100
	}
	Filter_Grunge_01 = {
		movie = 'Filter_Grunge_01'
		text = "Grunge Frame"
		loop_start = 1
		loop_end = 60
		last_frame = 61
		purchase_cost = 100
	}
	Filter_GunBarrel_01 = {
		movie = 'Filter_GunBarrel_01'
		text = "Gun Barrel"
		loop_start = 1
		loop_end = 60
		last_frame = 61
		purchase_cost = 100
	}
	Filter_Heraldry_01 = {
		movie = 'Filter_Heraldry_01'
		text = "Heraldry"
		loop_start = 1
		loop_end = 60
		last_frame = 61
		purchase_cost = 100
	}
	Filter_Printspots_01 = {
		movie = 'Filter_PrintSpots_01'
		text = "Print Edges"
		loop_start = 1
		loop_end = 60
		last_frame = 61
		purchase_cost = 100
	}
	Filter_CrinkledPaper_01 = {
		movie = 'Filter_CrinkledPaper_01'
		text = "Paper"
		loop_start = 1
		loop_end = 60
		last_frame = 61
		purchase_cost = 100
	}
	Filter_Fence_01 = {
		movie = 'Filter_Fence_01'
		text = "Fence"
		loop_start = 1
		loop_end = 60
		last_frame = 61
		purchase_cost = 100
	}
	Filter_sponsor_adio_32 = {
		movie = 'sponsor_adio_32'
		text = "adio"
		loop_start = 1
		loop_end = 31
		last_frame = 32
	}
	Filter_sponsor_almost_32 = {
		movie = 'sponsor_almost_32'
		text = "almost"
		loop_start = 1
		loop_end = 31
		last_frame = 32
	}
	Filter_sponsor_altamont_32 = {
		movie = 'sponsor_altamont_32'
		text = "altamont"
		loop_start = 1
		loop_end = 31
		last_frame = 32
	}
	Filter_sponsor_baker_32 = {
		movie = 'sponsor_baker_32'
		text = "baker"
		loop_start = 1
		loop_end = 31
		last_frame = 32
	}
	Filter_sponsor_billabong_32 = {
		movie = 'sponsor_billabong_32'
		text = "billabong"
		loop_start = 1
		loop_end = 31
		last_frame = 32
	}
	Filter_sponsor_birdhouse_32 = {
		movie = 'sponsor_birdhouse_32'
		text = "birdhouse"
		loop_start = 1
		loop_end = 31
		last_frame = 32
	}
	Filter_sponsor_dgk_32 = {
		movie = 'sponsor_dgk_32'
		text = "dgk"
		loop_start = 1
		loop_end = 31
		last_frame = 32
	}
	Filter_sponsor_dvs_32 = {
		movie = 'sponsor_dvs_32'
		text = "dvs"
		loop_start = 1
		loop_end = 31
		last_frame = 32
	}
	Filter_sponsor_electric_32 = {
		movie = 'sponsor_electric_32'
		text = "electric"
		loop_start = 1
		loop_end = 31
		last_frame = 32
	}
	Filter_sponsor_element_32 = {
		movie = 'sponsor_element_32'
		text = "element"
		loop_start = 1
		loop_end = 31
		last_frame = 32
	}
	Filter_sponsor_emerica_32 = {
		movie = 'sponsor_emerica_32'
		text = "emerica"
		loop_start = 1
		loop_end = 31
		last_frame = 32
	}
	Filter_sponsor_es_32 = {
		movie = 'sponsor_es_32'
		text = "es"
		loop_start = 1
		loop_end = 31
		last_frame = 32
	}
	Filter_sponsor_etnies_32 = {
		movie = 'sponsor_etnies_32'
		text = "etnies"
		loop_start = 1
		loop_end = 31
		last_frame = 32
	}
	Filter_sponsor_flip_32 = {
		movie = 'sponsor_flip_32'
		text = "flip"
		loop_start = 1
		loop_end = 31
		last_frame = 32
	}
	Filter_sponsor_focus_32 = {
		movie = 'sponsor_focus_32'
		text = "focus"
		loop_start = 1
		loop_end = 31
		last_frame = 32
	}
	Filter_sponsor_globe_32 = {
		movie = 'sponsor_globe_32'
		text = "globe"
		loop_start = 1
		loop_end = 31
		last_frame = 32
	}
	Filter_sponsor_habitat_32 = {
		movie = 'sponsor_habitat_32'
		text = "habitat"
		loop_start = 1
		loop_end = 31
		last_frame = 32
	}
	Filter_sponsor_hawk_clothing_32 = {
		movie = 'sponsor_hawk_clothing_32'
		text = "hawk clothing"
		loop_start = 1
		loop_end = 31
		last_frame = 32
	}
	Filter_sponsor_hurley_32 = {
		movie = 'sponsor_hurley_32'
		text = "hurley"
		loop_start = 1
		loop_end = 31
		last_frame = 32
	}
	Filter_sponsor_independent_32 = {
		movie = 'sponsor_independent_32'
		text = "independent"
		loop_start = 1
		loop_end = 31
		last_frame = 32
	}
	Filter_sponsor_matix_32 = {
		movie = 'sponsor_matix_32'
		text = "matix"
		loop_start = 1
		loop_end = 31
		last_frame = 32
	}
	Filter_sponsor_nike_sb_32 = {
		movie = 'sponsor_nike_sb_32'
		text = "nike sb"
		loop_start = 1
		loop_end = 31
		last_frame = 32
	}
	Filter_sponsor_nixon_32 = {
		movie = 'sponsor_nixon_32'
		text = "nixon"
		loop_start = 1
		loop_end = 31
		last_frame = 32
	}
	Filter_sponsor_oakley_32 = {
		movie = 'sponsor_oakley_32'
		text = "oakley"
		loop_start = 1
		loop_end = 31
		last_frame = 32
	}
	Filter_sponsor_ogio_32 = {
		movie = 'sponsor_ogio_32'
		text = "ogio"
		loop_start = 1
		loop_end = 31
		last_frame = 32
	}
	Filter_sponsor_pro_tec_32 = {
		movie = 'sponsor_pro_tec_32'
		text = "pro tec"
		loop_start = 1
		loop_end = 31
		last_frame = 32
	}
	Filter_sponsor_pro_tec_32 = {
		movie = 'sponsor_pro_tec_32'
		text = "pro tec"
		loop_start = 1
		loop_end = 31
		last_frame = 32
	}
	Filter_sponsor_quicksilver_32 = {
		movie = 'sponsor_quicksilver_32'
		text = "quicksilver"
		loop_start = 1
		loop_end = 31
		last_frame = 32
	}
	Filter_sponsor_rds_32 = {
		movie = 'sponsor_rds_32'
		text = "rds"
		loop_start = 1
		loop_end = 31
		last_frame = 32
	}
	Filter_sponsor_sessions_32 = {
		movie = 'sponsor_sessions_32'
		text = "sessions"
		loop_start = 1
		loop_end = 31
		last_frame = 32
	}
	Filter_sponsor_skull_candy_32 = {
		movie = 'sponsor_skull_candy_32'
		text = "skull candy"
		loop_start = 1
		loop_end = 31
		last_frame = 32
	}
	Filter_sponsor_slap_32 = {
		movie = 'sponsor_slap_32'
		text = "slap"
		loop_start = 1
		loop_end = 31
		last_frame = 32
	}
	Filter_sponsor_split_32 = {
		movie = 'sponsor_split_32'
		text = "split"
		loop_start = 1
		loop_end = 31
		last_frame = 32
	}
	Filter_sponsor_transworld_32 = {
		movie = 'sponsor_transworld_32'
		text = "transworld"
		loop_start = 1
		loop_end = 31
		last_frame = 32
	}
	Filter_sponsor_vans_32 = {
		movie = 'sponsor_vans_32'
		text = "vans"
		loop_start = 1
		loop_end = 31
		last_frame = 32
	}
	Filter_sponsor_volcom_stone_32 = {
		movie = 'sponsor_volcom_stone_32'
		text = "volcom stone"
		loop_start = 1
		loop_end = 31
		last_frame = 32
	}
	Filter_sponsor_von_zipper_32 = {
		movie = 'sponsor_von_zipper_32'
		text = "von zipper"
		loop_start = 1
		loop_end = 31
		last_frame = 32
	}
	Filter_sponsor_zoo_york_32 = {
		movie = 'sponsor_zoo_york_32'
		text = "zoo york"
		loop_start = 1
		loop_end = 31
		last_frame = 32
	}
	Filter_sponsor_zumiez_32 = {
		movie = 'sponsor_zumiez_32'
		text = "zumiez"
		loop_start = 1
		loop_end = 31
		last_frame = 32
	}
}

script ve_start_bink 
	printf \{'ve_start_bink'}
	if ismovieinbuffer movie = <movie>
		playmoviefrombuffer {
			buffer_slot = <buffer_slot>
			textureslot = ($ve_bink_texture_slot)
			start_frame = 1
			loop_start = <loop_start>
			loop_end = <loop_end>
			no_hold
			viewport = <viewport>
			viewport_render_nodes
		}
	else
		scriptassert 'Bink %s not loaded into a buffer!' s = <movie>
	endif
endscript

script ve_stop_bink 
	printf 've_stop_bink'
	if ismovieplaying textureslot = ($ve_bink_texture_slot)
		StopLoopingAndFinishMovie textureslot = ($ve_bink_texture_slot)
		printf 've_stop_bink - Start wait'
		begin
		if NOT ismovieplaying textureslot = ($ve_bink_texture_slot)
			break
		endif
		wait 1 gameframe
		repeat
		if screenelementexists id = video_editor_viewport_movie
			destroyscreenelement id = video_editor_viewport_movie
		endif
		broadcastevent type = ve_bink_stopped
		printf 've_stop_bink - Finished wait'
	endif
endscript

script ve_kill_bink 
	printf \{'ve_kill_bink'}
	killspawnedscript \{name = ve_stop_bink}
	killspawnedscript \{name = ve_skip_to_outro}
	killspawnedscript \{name = ve_play_looped_bink}
	if ismovieplaying textureslot = ($ve_bink_texture_slot)
		killmovie textureslot = ($ve_bink_texture_slot)
		broadcastevent \{type = ve_bink_stopped}
	endif
endscript

script ve_play_bink \{viewport = 0}
	if ismovieplaying textureslot = ($ve_bink_texture_slot)
		ve_kill_bink
	endif
	if ismovieplaying \{textureslot = 1}
		killmovie \{textureslot = 1}
	endif
	crib_wait_for_movies
	ve_start_bink {movie = (<bink>.movie) loop_start = (<bink>.loop_start) loop_end = (<bink>.loop_end) viewport = <viewport>}
endscript

script ve_allocate_bink_buffers 
	if NOT ve_in_playback_state
		scriptassert 've_allocate_bink_buffers - Need to be in playback memory state!'
	endif
	ve_set_memory_state state = playback_freed_peds
	buffer_size = 1300000
	ve_get_num_bink_buffer_slots
	if (<slots> = 0)
		return
	endif
	if NOT HasMovieBuffer buffer_slot = 0
		printf 've_allocate_bink_buffers'
		mempushcontext pedparts
		i = 0
		begin
		allocatemoviebuffer buffer_slot = <i> size = <buffer_size>
		i = (<i> + 1)
		repeat <slots>
		mempopcontext
	endif
endscript

script ve_free_bink_buffers 
	printf \{'ve_free_bink_buffers'}
	ve_get_num_bink_buffer_slots
	i = 0
	begin
	freemoviebuffer buffer_slot = <i>
	i = (<i> + 1)
	repeat <slots>
endscript

script ve_get_num_bink_buffer_slots 
	if isxenon
		return \{slots = 5}
	else
		return \{slots = 3}
	endif
endscript

script ve_get_unused_bink_buffer_slot 
	used = [0 0 0]
	i = 0
	getarraysize <overlays>
	if (<array_size> > 0)
		begin
		bink = ((<overlays> [<i>]).name)
		if structurecontains structure = (($video_editor_bink_details).<bink>) movie
			movie_filename = ((($video_editor_bink_details).<bink>).movie)
			if ismovieinbuffer movie = <movie_filename>
				setarrayelement arrayname = used index = <buffer_slot> newvalue = 1
			endif
		endif
		i = (<i> + 1)
		repeat <array_size>
	endif
	getarraysize <used>
	i = 0
	begin
	if ((<used> [<i>]) = 0)
		return true buffer_slot = <i>
	endif
	i = (<i> + 1)
	repeat <array_size>
	return false
endscript

script ve_ensure_binks_loaded overlays = []
	i = 0
	getarraysize <overlays>
	if (<array_size> > 0)
		ve_allocate_bink_buffers
		begin
		bink = ((<overlays> [<i>]).name)
		if structurecontains structure = (($video_editor_bink_details).<bink>) movie
			movie_filename = ((($video_editor_bink_details).<bink>).movie)
			if NOT ismovieinbuffer movie = <movie_filename>
				if ve_get_unused_bink_buffer_slot overlays = <overlays>
					printf 'Loading %s into buffer #%d' s = <movie_filename> d = <buffer_slot>
					loadmovieintobuffer buffer_slot = <buffer_slot> movie = <movie_filename>
					if NOT ismovieinbuffer movie = <movie_filename>
						scriptassert 'Error loading %s' s = <movie_filename>
					endif
				else
					scriptassert 'No unused buffer slot to load bink into... More than 3 unique in a timeline?'
				endif
			endif
		endif
		i = (<i> + 1)
		repeat <array_size>
	endif
endscript

script ve_overlays_break_bink_limit 
	new_entry = [none]
	unique_binks = []
	i = 0
	getarraysize <overlays>
	if (<array_size> > 0)
		begin
		array_bink = ((<overlays> [<i>]).name)
		if (<array_bink> = <bink>)
			return false
		endif
		if NOT arraycontains array = <unique_binks> contains = <array_bink>
			setarrayelement arrayname = new_entry index = 0 newvalue = <array_bink>
			unique_binks = (<unique_binks> + <new_entry>)
		endif
		i = (<i> + 1)
		repeat <array_size>
	endif
	getarraysize <unique_binks>
	ve_get_num_bink_buffer_slots
	if (<array_size> < <slots>)
		return false
	endif
	return true
endscript
