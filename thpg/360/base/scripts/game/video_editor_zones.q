ve_hard_load_zone = none
ve_current_recording_area = Area_None
ve_zone_objects_kill_and_recreate = [
	Z_FDR_occluder_doors_3n4
	Z_FDR_occluder_doors_1n2
	Z_FDR_o_mb_rolling_door_1
	Z_FDR_o_mb_rolling_door_2
	Z_FDR_o_mb_rolling_door_4
	Z_FDR_o_mb_rolling_door_3
	Z_WP_Bridge_LO_train_01
	Z_WP_Bridge_LO_train_02
	z_slums_obj_parkgate1
	z_slums_obj_parkgate2
	Z_Slums_obj_white_door
	Z_Slums_obj_white_door2
	Z_Slums_proxim_whitedoor
	Z_Slums_TRG_train_ghost2
	Z_Slums_TRG_train_ghost
	Z_Slums_train
	Z_BCity_TRG_BCity_TrainFX
	Z_BCity_TRG_BCity_TrainBail
	Z_bcity_train_01
	Z_BCity_g_TK_GandE_doors_01
	Z_BCity_g_TK_GandE_doors_02
	Z_BCity_g_TK_GandE_doors_03
	Z_BCity_g_TK_GandE_doors_04
	Z_BCity_theatre_door01
	Z_BCity_theatre_door02
	Z_BCity_theatre_door03
	Z_BCity_theatre_door04
	Z_BCity_theatre_door05
	Z_BCity_theatre_door06
	Z_BCity_theatre_door07
	Z_BCity_theatre_door08
	Z_BCity_theatre_Upstairs_door01
	Z_BCity_theatre_Upstairs_door02
	Z_BCity_theatre_Upstairs_door03
	Z_BCity_theatre_Upstairs_door04
	Z_Harbor_fx_SecretGrate
	Z_lansdowne_g_prefab_gate_01
	Z_lansdowne_g_prefab_gate_02
	Z_Lansdowne_g_cellardoor_closed
	Z_Lansdowne_g_cellardoor_closed_COL
	Z_Lansdowne_TRG_prefab_gate_exit
	Z_Lansdowne_TRG_prefab_gate_inside
	Z_Lansdowne_TRG_prefab_gate_outside
	Z_FDR_PH_FDR_Seagulls_Scatter01
	Z_FDR_PH_FDR_Seagulls_Scatter02
	Z_FDR_PH_FDR_Seagulls_Scatter03
	Z_FDR_PH_FDR_Seagulls_Scatter05
	Z_FDR_PH_FDR_Seagulls_Under04
	Z_FDR_PH_FDR_Seagulls_Under01
	Z_Harbor_PH_Seagulls_Scatter02
	Z_Harbor_PH_Seagulls_Scatter01
	Z_Monuments_PH_Seagulls_Scatter02
	Z_Monuments_PH_Seagulls_Scatter03
	Z_Monuments_LO_FBI_Door_01
	Z_Monuments_LO_FBI_Door_02
	Z_Monuments_LO_Art_Gallery_Door_01
	Z_Monuments_LO_Art_Gallery_Door_02
	Z_Monuments_LO_Art_Gallery_Door_03
	Z_Monuments_LO_Art_Gallery_Door_04
	Z_Monuments_LO_Art_Gallery_Door_05
	Z_Monuments_LO_Art_Gallery_Door_06
	Z_Monuments_LO_Navy_Memorial_Door_01
	Z_Monuments_LO_Navy_Memorial_Door_02
	Z_Monuments_LO_Navy_Memorial_Door_03
	Z_Monuments_LO_Navy_Memorial_Door_04
	Z_Monuments_LO_Navy_Memorial_Door_05
	Z_Monuments_LO_Navy_Memorial_Door_06
	Z_Monuments_LO_Union_Station_Doors_01
	Z_Monuments_LO_Union_Station_Doors_02
	Z_Monuments_LO_Union_Station_Doors_03
	Z_Monuments_LO_Union_Station_Doors_04
	Z_Monuments_LO_Union_Station_Doors_05
	Z_Monuments_LO_Union_Station_Doors_06
	Z_Monuments_Proxim_Art_Gallery_Doors_01
	Z_Monuments_Proxim_Art_Gallery_Doors_02
	Z_Monuments_Proxim_Art_Gallery_Occluders_Close_01
	Z_Monuments_Proxim_Art_Gallery_Occluders_Kill_Create_01
	Z_Monuments_Proxim_FBI_Doors_01
	Z_Monuments_Proxim_Navy_Memorial_Doors
	Z_Monuments_Proxim_Union_Station_Doors_Close_01
	Z_Monuments_Proxim_Union_Station_Doors_Open_01
	Z_Monuments_Proxim_Union_Station_Doors_Open_02
	Z_PB_Bridge_PH_Seagulls_Scatter01
	Z_PB_Bridge_PH_Seagulls_Scatter02
	Z_PB_Bridge_PH_Seagulls_Scatter03
	Z_PB_Bridge_PH_Seagulls_Scatter04
	Z_WP_Bridge_TRG_Train_Proxim
	Z_WP_Bridge_train_vibrate_01
	Z_WP_Bridge_Train_01
	Z_Love_fx_tunnel_2x4_01
	Z_Love_fx_tunnel_2x4_02
	Z_Love_fx_tunnel_2x4_03
	Z_Love_fx_tunnel_plywood01
	Z_Love_fx_tunnel_plywood02
	Z_Love_fx_tunnel_plywood03
	Z_Love_fx_tunnel_plywood04
	Z_Museums_g_art_museum_front_door00
	Z_Museums_g_art_museum_front_door01
	Z_Museums_g_art_museum_front_door02
	Z_Museums_g_art_museum_front_door03
	Z_Museums_g_art_museum_front_door04
	Z_Museums_g_art_museum_front_door05
	Z_Museums_Proxim_Art_Gallery_Doors_01
	Z_Museums_Proxim_Art_Gallery_Doors_02
	Z_Museums_Proxim_Art_Gallery_Doors_03
	Z_Museums_G_JG_AandS_SewerCover01
	Z_Museums_G_JG_AandS_SewerCover02
	Z_Museums_G_JG_Mall_SewerCover01
	Z_Museums_Shatter_VGer_Panel
	Z_Monuments_g_lamp_post_bulb_1
	Z_Monuments_g_lamp_post_bulb_2
	Z_Monuments_g_lamp_post_bulb_3
	Z_Monuments_g_lamp_post_bulb_4
	Z_Monuments_g_lamp_post_bulb_5
	Z_Monuments_g_lamp_post_bulb_6
	Z_Monuments_g_lamp_post_bulb_7
	Z_Monuments_g_lamp_post_bulb_8
	Z_Monuments_g_lamp_post_bulb_9
	Z_Monuments_g_lamp_post_bulb_10
	Z_Monuments_g_lamp_post_bulb_11
	Z_Monuments_g_lamp_post_bulb_12
	Z_Monuments_g_lamp_post_bulb_13
	Z_Monuments_g_lamp_post_bulb_14
	Z_Monuments_g_lamp_post_bulb_15
	Z_Monuments_g_lamp_post_bulb_16
	Z_Monuments_g_lamp_post_bulb_17
	Z_Monuments_g_lamp_post_bulb_18
	Z_Monuments_g_lamp_post_bulb_19
	Z_Monuments_g_lamp_post_bulb_20
	Z_Monuments_g_Art_Gallery_Roof_Dome_Glass_01
	Z_Monuments_g_Art_Gallery_Roof_Dome_Glass_02
	Z_Monuments_g_Art_Gallery_Roof_Dome_Glass_03
	Z_Monuments_g_Art_Gallery_Roof_Dome_Glass_04
	Z_Monuments_g_Art_Gallery_Roof_Dome_Glass_05
	Z_Monuments_g_Art_Gallery_Roof_Dome_Glass_06
	Z_Museum_Int_I_JP_WB_Display_Glass_07
	Z_Museum_Int_I_JP_WB_Display_Glass_08
	Z_Museum_Int_I_JP_WB_Display_Glass_09
	Z_Museum_Int_I_JP_WB_Display_Glass_10
	Z_Museum_Int_I_JP_WB_Display_Glass_11
	Z_Museum_Int_I_JP_WB_Display_Glass_12
	Z_Museum_Int_I_JP_WB_Display_Glass_13
	Z_Museum_Int_I_JP_WB_Display_Glass_14
	Z_Museum_Int_I_JP_WB_Display_Glass_15
	Z_Museum_Int_I_JP_WB_Display_Glass_16
	Z_Museum_Int_I_JP_WB_Display_Glass_17
	Z_Museum_Int_I_JP_WB_Display_Glass_18
	Z_Museum_Int_I_JP_WB_Display_Glass_19
	Z_Museum_Int_I_JP_WB_Display_Glass_20
	Z_Museum_Int_I_JP_WB_Display_Glass_21
	Z_Museum_Int_I_JP_WB_Display_Glass_22
	Z_Museum_Int_I_JP_WB_Display_Glass_23
	Z_Museum_Int_I_JP_WB_Display_Glass_24
	Z_Museum_Int_I_JP_WB_Display_Glass_25
	Z_Museum_Int_I_JP_WB_Display_Glass_26
	Z_Museum_Int_I_JP_WB_Display_Glass_27
]
ve_zone_objects_killed = [
	z_slums_train2
	Z_bcity_train_02
	Z_WP_Bridge_Train_02
	Z_WP_Bridge_Train_03
	Z_WP_Bridge_Train_04
	Z_Lansdowne_g_prefab_gate_COL_inside01
	Z_Lansdowne_g_prefab_gate_COL_inside02
	Z_Lansdowne_g_prefab_gate_COL_outside01
	Z_Lansdowne_g_prefab_gate_COL_outside02
]
ve_zone_scripts_killed = [
	z_wp_bridge_train
	Z_WP_Bridge_Train_2
	Z_WP_Bridge_Train_3
	Z_WP_Bridge_Train_4
	Z_WP_Bridge_Train_Move_Random_When_above_spawn
	Z_Monuments_Art_Gallery_Doors_Open_01
	Z_Monuments_Art_Gallery_Doors_Open_02
	Z_Monuments_Art_Gallery_Doors_Close
	Z_Monuments_Union_Station_Doors_Open_01
	Z_Monuments_Union_Station_Doors_Open_02
	Z_Monuments_Union_Station_Doors_Close
	z_museums_art_gallery_doors_open1
	z_museums_art_gallery_doors_open2
	z_museums_art_gallery_doors_close
	Z_Slums_Train_Rumble_Effect_spawned
	Z_BCity_Train_FX_on_spawned
]
ve_area_safe_zones = {
	Area_DC = z_museums
	Area_Philly = z_love
	Area_Baltimore = z_bcity
	Area_Crib = z_crib
}
ve_area_safe_zone_load_scripts = {
	Area_DC = Load_Z_Museums
	Area_Philly = Load_Z_Love
	Area_Baltimore = Load_Z_BCity
	Area_Crib = load_z_crib
}
VideoEditorExtraZones = {
	z_pb_bridge = {
		name = 'Z_PB_Bridge'
		params_struct = z_pb_bridge_params
	}
	z_bw_bridge = {
		name = 'Z_BW_Bridge'
		params_struct = z_bw_bridge_params
	}
	z_wp_bridge = {
		name = 'Z_WP_Bridge'
		params_struct = z_wp_bridge_params
	}
}
ve_extra_zone_lookup = {
	z_slums = [
		z_pb_bridge
	]
	z_bcity = [
		z_pb_bridge
	]
	z_harbor = [
		z_bw_bridge
	]
	z_lansdowne = [
		z_bw_bridge
	]
	z_monuments = [
		z_bw_bridge
		z_wp_bridge
	]
	z_museums = [
		z_bw_bridge
	]
	z_museum_int = [
		z_bw_bridge
	]
}

script ve_in_recordable_area 
	if NOT gotparam \{area}
		Get_Current_Area
	endif
	switch <area>
		case Area_Other
		case Area_Bridges
		return \{false}
		default
		return true area = <area>
	endswitch
endscript

script ve_should_cancel_recording 
	Get_Current_Area
	if NOT (<area> = $ve_current_recording_area)
		stars
		printf \{'Cancelling recording, we went out of the area!'}
		stars
		return \{true}
	endif
	return \{false}
endscript

script ve_set_recording_area 
	Get_Current_Area
	change ve_current_recording_area = <area>
endscript

script ve_area_check_script object = skater
	VideoZoneTrackFunc reset
	ve_log_zone elapsed_duration = 0.0
	track_interval = 40
	track_time = 0
	begin
	wait 1 gameframe
	if NOT <object> :export_isrecording
		return
	endif
	if ve_should_cancel_recording
		stars
		printf 'Skater left recording area'
		stars
		ve_stop_recording object = <object>
		return
	endif
	if (<track_time> > <track_interval>)
		<object> :export_getduration
		ve_log_zone elapsed_duration = <elapsed_duration>
		track_time = 0
	endif
	track_time = (<track_time> + 1)
	repeat
endscript

script ve_log_zone 
	if getpakmancurrentname \{map = zones}
		formattext checksumname = current_zone '%s' s = <pakname>
		VideoZoneTrackFunc trackzone zone = <current_zone> time = <elapsed_duration>
	endif
endscript

script ve_get_zone_list_for_clips 
	getarraysize <clips>
	num_clips = <array_size>
	zones = []
	extra_zones = []
	new_entry = [zone]
	if (<num_clips> > 0)
		i = 0
		begin
		if ve_get_clip_data name = ((<clips> [<i>]).name)
			if structurecontains structure = <clip> zones
				getarraysize (<clip>.zones)
				if (<array_size> > 0)
					z = 0
					begin
					clip_zone = ((<clip>.zones) [<z>])
					if NOT arraycontains array = <zones> contains = <clip_zone>
						setarrayelement arrayname = new_entry index = 0 newvalue = <clip_zone>
						zones = (<zones> + <new_entry>)
					endif
					z = (<z> + 1)
					repeat <array_size>
				endif
				getarraysize (<clip>.extra_zones)
				if (<array_size> > 0)
					z = 0
					begin
					clip_zone = ((<clip>.extra_zones) [<z>])
					if NOT arraycontains array = <extra_zones> contains = <clip_zone>
						setarrayelement arrayname = new_entry index = 0 newvalue = <clip_zone>
						extra_zones = (<extra_zones> + <new_entry>)
					endif
					z = (<z> + 1)
					repeat <array_size>
				endif
			endif
		endif
		i = (<i> + 1)
		repeat <num_clips>
	endif
	getarraysize <zones>
	if (<array_size> = 0)
		scriptassert 'Clip has no zones!'
	endif
	return zones = <zones> extra_zones = <extra_zones>
endscript

script ve_expand_zones_to_links 
	linked_zones = <zones>
	getarraysize <zones>
	num_zones = <array_size>
	new_entry = [zone]
	i = 0
	if (<num_zones> > 0)
		begin
		zone = (<zones> [<i>])
		if structurecontains structure = ($WWWZones) <zone>
			if structurecontains structure = (($WWWZones).<zone>) zones
				zone_links = ((($WWWZones).<zone>).zones)
				getarraysize <zone_links>
				if (<array_size> > 0)
					iLink = 0
					begin
					zone_link = (<zone_links> [<iLink>])
					if NOT structurecontains structure = $VideoEditorExtraZones <zone_link>
						if NOT arraycontains array = <linked_zones> contains = <zone_link>
							setarrayelement arrayname = new_entry index = 0 newvalue = <zone_link>
							linked_zones = (<linked_zones> + <new_entry>)
						endif
					endif
					iLink = (<iLink> + 1)
					repeat <array_size>
				endif
			endif
		endif
		i = (<i> + 1)
		repeat <num_zones>
	endif
	return linked_zones = <linked_zones>
endscript
ve_zone_change_level_action = none
ve_zone_change_level_action_params = {
}

script ve_pick_correct_pakman_map 
	if gotparam hard_load_zone
		first_zone = <hard_load_zone>
	else
		Get_Area_Data area = <area>
		first_zone = ((<area_data>.zones) [0])
	endif
	if NOT ExistsInPakManMap map = zones <first_zone>
		if gotparam save_edit
			video_editor_commit_to_profile
		endif
		change ve_zone_change_level_action = <action>
		change ve_zone_change_level_action_params = <action_params>
		if gotparam record_last
			ve_record_hard_load_last_zone
		endif
		ve_restore_temp_changes
		ve_free_temporaries_level_unload
		blockpendingpakmanloads map = zones block_scripts = 1
		setslomo 1.0
		unpausegame
		change video_editor_fs_playback = 1
		if gotparam hard_load_zone
			extendcrc <hard_load_zone> '_params' out = zone_params
			if structurecontains structure = ($SkateZoneParams) <zone_params>
				prefix = ($SkateZoneParams.<zone_params>.prefix)
				extendcrc load_ <prefix> out = load_script
			else
				load_script = (($ve_area_safe_zone_load_scripts).<area>)
			endif
		else
			load_script = (($ve_area_safe_zone_load_scripts).<area>)
		endif
		spawnscriptnow noqbid change_level params = {level = <load_script> ve_zone_load}
		if NOT gotparam no_waits
			block type = gameflow_playrun
		endif
		return false
	endif
	return true
endscript

script ve_change_level_done 
	if NOT (($ve_zone_change_level_action) = none)
		printf \{'ve_change_level_done'}
		if NOT (($ve_zone_change_level_action) = pause_game_and_create_pause_menu)
			ve_enter_video_editor
			memcard_validate_known_device
		endif
		destroy_dialog_box
		if screenelementexists \{id = ve_zone_change_animation_icon}
			runscriptonscreenelement \{id = ve_zone_change_animation_icon
				net_view_goals_searching_fade_out_and_die}
		endif
		printstruct ($ve_zone_change_level_action)
		printstruct ($ve_zone_change_level_action_params)
		($ve_zone_change_level_action) {($ve_zone_change_level_action_params) change_level}
		change \{ve_zone_change_level_action = none}
		change \{ve_zone_change_level_action_params = {
			}}
	endif
endscript

script ve_remove_blackout 
	if screenelementexists \{id = ve_zone_change_blackout}
		destroyscreenelement \{id = ve_zone_change_blackout}
	endif
endscript

script ve_check_playback_area 
	if IsPakManStreamingEnabled
		scriptassert 'Eh? Streaming needs to be off here!'
	endif
	ve_expand_zones_to_links zones = <zones>
	getarraysize <linked_zones>
	hard_load = 0
	i = 0
	if (<array_size> > 0)
		begin
		zone = (<linked_zones> [<i>])
		if NOT zoneloadedandparsed <zone>
			printf 'Zone %z not found!' z = <zone> dontassertforchecksums
			hard_load = 1
		endif
		i = (<i> + 1)
		repeat <array_size>
	endif
	if (<hard_load> = 1)
		safe_zone = (($ve_area_safe_zones).<area>)
		if gotparam safe_zone
			stars
			printf 'Doing hard load into area %a, zone=%z' a = <area> z = <safe_zone>
			stars
			ve_show_loading_screen
			ve_clear_extra_zone
			ve_record_hard_load_last_zone
			setpakmancurrentblock map = zones pak = <safe_zone> block_scripts = 1
		endif
	endif
	if NOT gotparam safe_zone
		blockpendingpakmanloads map = zones block_scripts = 1
		ve_stall_for_zone_loads
	endif
	getarraysize <extra_zones>
	i = 0
	if (<array_size> > 0)
		begin
		extra_zone = (<extra_zones> [<i>])
		if NOT zoneloadedandparsed <extra_zone>
			printf 'Extra Zone %z not found!' z = <extra_zone> dontassertforchecksums
			if gotparam need_extra_zone
				printstruct <...>
				scriptassert 'Some problem with extra_zone stuff... We should only ever need one!'
			endif
			need_extra_zone = <extra_zone>
		endif
		i = (<i> + 1)
		repeat <array_size>
	endif
	if gotparam need_extra_zone
		if NOT ve_have_extra_zone_loaded zone = <need_extra_zone>
			ve_set_memory_state state = playback_freed_peds
			ve_show_loading_screen
			stars
			printf 'extra_zone=%z' z = <need_extra_zone>
			stars
			ve_set_extra_zone zone = <need_extra_zone>
			ve_stall_for_zone_loads
		endif
	endif
	if gotparam shown_loading_screen
		ve_hide_loading_screen
	endif
endscript

script ve_alloc_extra_zones 
	if NOT ($ve_memory_state = playback_freed_peds)
		scriptassert \{'ve_alloc_extra_zones - Need to have freed the peds up to allocate this!'}
	endif
	if NOT existspakmanmap \{map = extra_ve_zones}
		mempushcontext \{pedparts}
		createpakmanmap \{map = extra_ve_zones
			links = VideoEditorExtraZones
			folder = 'zones/'}
		mempopcontext
	endif
endscript

script ve_free_extra_zones 
	if existspakmanmap \{map = extra_ve_zones}
		setpakmancurrentblock \{map = extra_ve_zones
			pak = none
			block_scripts = 1}
		destroypakmanmap \{map = extra_ve_zones}
	endif
endscript

script ve_set_extra_zone 
	if ($ve_memory_state = playback_freed_peds)
		if NOT existspakmanmap \{map = extra_ve_zones}
			scriptassert \{'Eh? we should have the extra_ve_zones map'}
		endif
	endif
	if NOT zoneloadedandparsed <zone>
		ve_alloc_extra_zones
		setpakmancurrentblock map = extra_ve_zones pak = <zone> block_scripts = 1
	endif
endscript

script ve_clear_extra_zone 
	if existspakmanmap \{map = extra_ve_zones}
		setpakmancurrentblock \{map = extra_ve_zones
			pak = none
			block_scripts = 1}
	endif
endscript

script ve_have_extra_zone_loaded 
	if existspakmanmap \{map = extra_ve_zones}
		if getpakmancurrentname \{map = extra_ve_zones}
			formattext checksumname = current_zone '%s' s = <pakname>
			if (<current_zone> = <zone>)
				return \{true}
			endif
		endif
	endif
	return \{false}
endscript

script ve_get_clips_area 
	getarraysize <clips>
	if (<array_size> > 0)
		if ve_get_clip_data name = ((<clips> [0]).name)
			return true area = (<clip>.area)
		endif
	endif
	return \{false}
endscript

script extra_ve_zones_PakMan_Init 
	printf \{'extra_ve_zones_PakMan_Init'}
	zones_pakman_init <...>
endscript

script extra_ve_zones_PakMan_DeInit 
	printf \{'extra_ve_zones_PakMan_DeInit'}
	zones_pakman_deinit <...>
endscript

script ve_record_hard_load_last_zone 
	if ($ve_hard_load_zone = none)
		if getpakmancurrentname \{map = zones}
			formattext checksumname = current_zone '%s' s = <pakname>
			change ve_hard_load_zone = <current_zone>
		endif
	endif
endscript

script ve_back_to_hard_load_last_zone \{action = pause_game_and_create_pause_menu}
	if NOT ($ve_hard_load_zone = none)
		ve_clear_extra_zone
		hard_load_zone = ($ve_hard_load_zone)
		change \{ve_hard_load_zone = none}
		Get_Area_From_Zone zone = <hard_load_zone>
		if ve_pick_correct_pakman_map area = <area> hard_load_zone = <hard_load_zone> action = <action> action_params = {}
			setpakmancurrentblock map = zones pak = <hard_load_zone> block_scripts = 1
		endif
	endif
endscript

script ve_cleanup_zone_objects 
	ve_stall_for_zone_loads
	ve_cleanup_zone_objects_array array = ($ve_zone_objects_kill_and_recreate)
	ve_cleanup_zone_objects_array array = ($ve_zone_objects_killed)
	ve_cleanup_zone_scripts_array array = ($ve_zone_scripts_killed)
	killspawnedscript id = bridge_log_wait
	if scriptexists Z_Slums_Junk_Crane_VideoEditor_Enter
		Z_Slums_Junk_Crane_VideoEditor_Enter
	endif
	if globalexists name = z_museums_Art_Gallery_Doors_Opened_Museums
		change z_museums_Art_Gallery_Doors_Opened_Museums = 0
	endif
	if globalexists name = z_museums_Art_Gallery_Doors_Opened_Monuments
		change z_museums_Art_Gallery_Doors_Opened_Monuments = 0
	endif
	if globalexists name = Z_Monuments_Art_Gallery_Doors_Opened_Monuments
		change Z_Monuments_Art_Gallery_Doors_Opened_Monuments = 0
	endif
	if globalexists name = Z_Monuments_Art_Gallery_Doors_Opened_Museums
		change Z_Monuments_Art_Gallery_Doors_Opened_Museums = 0
	endif
	if globalexists name = Z_Monuments_Union_Station_Doors_Opened_Monuments
		change Z_Monuments_Union_Station_Doors_Opened_Monuments = 0
	endif
	if globalexists name = Z_Monuments_Union_Station_Doors_Opened_Subway
		change Z_Monuments_Union_Station_Doors_Opened_Subway = 0
	endif
	if globalexists name = GLOBAL_Z_LANS_GATESOPENEDIN
		change GLOBAL_Z_LANS_GATESOPENEDIN = 0
	endif
	if globalexists name = GLOBAL_Z_LANS_GATESOPENEDOUT
		change GLOBAL_Z_LANS_GATESOPENEDOUT = 0
	endif
	skater :vibrate actuator = 0 percent = 0
endscript

script ve_cleanup_zone_objects_array 
	getarraysize <array>
	i = 0
	begin
	obj_name = (<array> [<i>])
	if isinnodearray <obj_name>
		if iscreated <obj_name>
			kill name = <obj_name>
		endif
	endif
	i = (<i> + 1)
	repeat <array_size>
endscript

script ve_cleanup_zone_scripts_array 
	getarraysize <array>
	i = 0
	begin
	script_name = (<array> [<i>])
	killspawnedscript name = <script_name>
	i = (<i> + 1)
	repeat <array_size>
endscript

script ve_restore_zone_objects 
	ve_stall_for_zone_loads
	ve_restore_zone_objects_array array = ($ve_zone_objects_kill_and_recreate)
	spawnscriptlater \{ve_force_update_proxims}
	if scriptexists \{Z_Slums_Junk_Crane_VideoEditor_Exit}
		Z_Slums_Junk_Crane_VideoEditor_Exit
	endif
endscript

script ve_force_update_proxims 
	skater :proximtrigger_setactive \{active = 0}
	wait \{2
		gameframes}
	skater :proximtrigger_setactive \{active = 1}
endscript

script ve_restore_zone_objects_array 
	getarraysize <array>
	i = 0
	begin
	obj_name = (<array> [<i>])
	if isinnodearray <obj_name>
		if NOT iscreated <obj_name>
			create name = <obj_name>
		endif
	endif
	i = (<i> + 1)
	repeat <array_size>
endscript

script ve_get_zones_for_recorded_clip 
	if replay_asset_exists name = <name>
		replay_get_length name = <name>
	else
		length = ($ve_max_record_time)
	endif
	VideoZoneTrackFunc getzones time = <elapsed_duration> length = <length>
	VideoZoneTrackFunc reset
	extra_zones = []
	getarraysize <zones>
	num_zones = <array_size>
	if (<num_zones> > 0)
		i = 0
		begin
		current_zone = (<zones> [<i>])
		if structurecontains structure = $ve_extra_zone_lookup <current_zone>
			extra_zone_list = ($ve_extra_zone_lookup.<current_zone>)
			getarraysize <extra_zone_list>
			j = 0
			begin
			extra_zone_name = (<extra_zone_list> [<j>])
			if NOT arraycontains array = <extra_zones> contains = <extra_zone_name>
				addarrayelement array = <extra_zones> element = <extra_zone_name>
				extra_zones = <array>
			endif
			j = (<j> + 1)
			repeat <array_size>
		endif
		i = (<i> + 1)
		repeat <num_zones>
	endif
	return recorded_zones = <zones> recorded_extra_zones = <extra_zones>
endscript

script ve_set_ve_used_nodeflags 
	if structurecontains structure = ($ve_saved_node_flags) empty
		scriptassert \{'ve_backup_node_flags not called!'}
	endif
	changenodeflag \{nodeflag_bell_subway_lock
		1}
	changenodeflag \{nodeflag_z_fdr_attackers
		0}
endscript

script ve_stall_for_pakman 
	if ispakmanloading \{map = zones}
		begin
		wait \{1
			gameframe}
		if NOT ispakmanloading \{map = zones}
			break
		endif
		repeat
		return \{true}
	endif
	return \{false}
endscript

script ve_stall_for_nodearray 
	if nodearraybusy
		begin
		wait \{1
			gameframe}
		if NOT nodearraybusy
			break
		endif
		repeat
		return \{true}
	endif
	return \{false}
endscript

script ve_stall_for_zone_loads 
	begin
	stalled = 0
	if ve_stall_for_pakman
		stalled = 1
	endif
	if ve_stall_for_nodearray
		stalled = 1
	endif
	if (<stalled> = 0)
		break
	endif
	repeat
endscript
